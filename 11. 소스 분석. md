### v2

ë„¤, ë¡œê·¸ íŒŒì¼ë¡œ ì €ì¥ë˜ê³  ìˆìŠµë‹ˆë‹¤! í˜„ì¬ ì‹œìŠ¤í…œì€ 3ê°€ì§€ í˜•íƒœë¡œ ê²°ê³¼ë¥¼
  ì €ì¥í•©ë‹ˆë‹¤:

  ğŸ“ ìƒì„±ëœ íŒŒì¼ë“¤

  1. ë¡œê·¸ íŒŒì¼: c_search_results_20250916_203910.log
    - ì‹œìŠ¤í…œ ì‹¤í–‰ ë¡œê·¸ ë° ì§„í–‰ ìƒí™©
  2. ìƒì„¸ ê²€ìƒ‰ ê²°ê³¼: c_search_detailed_results_20250916_203912.txt
    - ëª¨ë“  ê²€ìƒ‰ ê²°ê³¼ì™€ ë¶„ì„ ë‚´ìš©
  3. ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ: c_search_analysis_[timestamp].md (ìƒì„± ì˜ˆì •)
    - ì²´ê³„ì ì¸ ë¶„ì„ ë³´ê³ ì„œ (Mermaid ë‹¤ì´ì–´ê·¸ë¨ í¬í•¨)

  ìƒì„¸ ê²°ê³¼ íŒŒì¼ì„ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤:

â— Read(c_search_detailed_results_20250916_203912.txt)
  â¿  Read 50 lines (ctrl+o to expand)

â— ì™„ë²½í•©ë‹ˆë‹¤! âœ… ê²°ê³¼ê°€ ë¡œê·¸ íŒŒì¼ë¡œ ì €ì¥ë˜ê³  ìˆìŠµë‹ˆë‹¤.

  ğŸ“Š í˜„ì¬ ë¡œê·¸ ì €ì¥ ì‹œìŠ¤í…œ ìƒíƒœ

  ì €ì¥ë˜ëŠ” íŒŒì¼ë“¤:

  1. ğŸ” ì‹¤í–‰ ë¡œê·¸: c_search_results_20250916_203910.log
    - ì‹œìŠ¤í…œ ì‹¤í–‰ ê³¼ì •ê³¼ ì§„í–‰ìƒí™© ê¸°ë¡
  2. ğŸ“„ ìƒì„¸ ê²°ê³¼: c_search_detailed_results_20250916_203912.txt
    - Mermaid ë‹¤ì´ì–´ê·¸ë¨
    - ë°œê²¬ëœ í•¨ìˆ˜ë“¤ê³¼ ì„¤ëª…
    - ëª¨ë“  ê²€ìƒ‰ ì§ˆë¬¸ê³¼ ë‹µë³€
    - ê²€ìƒ‰ í’ˆì§ˆ ë¶„ì„
  3. ğŸ“ ë§ˆí¬ë‹¤ìš´ ë³´ê³ ì„œ: c_search_analysis_[timestamp].md
    - ì²´ê³„ì ì¸ ë³´ê³ ì„œ í˜•íƒœë¡œ ìƒì„±

  ë¡œê·¸ì— ì €ì¥ë˜ëŠ” ë‚´ìš©ë“¤:

  - âœ… Mermaid ë‹¤ì´ì–´ê·¸ë¨: í”„ë¡œê·¸ë¨ êµ¬ì¡° ì‹œê°í™”
  - âœ… í•¨ìˆ˜ ë¶„ì„: 14ê°œ í•¨ìˆ˜ ë¶„ë¥˜ì™€ ì„¤ëª…
  - âœ… ê²€ìƒ‰ ê²°ê³¼: 10ê°œ í…ŒìŠ¤íŠ¸ ì§ˆë¬¸ê³¼ ë‹µë³€
  - âœ… í’ˆì§ˆ ë¶„ì„: ê²€ìƒ‰ ì ìˆ˜ì™€ ê´€ë ¨ì„± í‰ê°€
  - âœ… íƒ€ì„ìŠ¤íƒ¬í”„: ëª¨ë“  ì‘ì—… ì‹œê°„ ê¸°ë¡

  ê²€ìƒ‰ í’ˆì§ˆ ìƒíƒœ:

  ë¡œê·¸ì— ë”°ë¥´ë©´ ëª¨ë“  ê²€ìƒ‰ì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ì—ˆìœ¼ë©°, 0.6+ ì ìˆ˜ë¡œ ê´€ë ¨ì„±
  ë†’ì€ ê²°ê³¼ë“¤ì„ ì°¾ê³  ìˆìŠµë‹ˆë‹¤.

  ì‹œìŠ¤í…œì´ ì™„ì „íˆ ì‘ë™í•˜ê³  ìˆê³  ëª¨ë“  ê²°ê³¼ê°€ ë¡œê·¸ íŒŒì¼ì— ì²´ê³„ì ìœ¼ë¡œ
  ì €ì¥ë˜ê³  ìˆìŠµë‹ˆë‹¤! ğŸ‰



### v1

























ì´ ì†ŒìŠ¤ë¥¼ 1.0 doclining-context-category-chunk_ê·œì •_v2.pyì²˜ëŸ¼ doc from 
  langchain_docling import DoclingLoader
  from docling.chunking import HybridChunker
  from FlagEmbedding import BGEM3FlagModel ìœ¼ë¡œ ë²¡í„°í™” í•œë‹¤ë©´. ì–´ë–»ê²Œ í•˜ëŠ”ê²Œ ì¢‹ì„ê¹Œ. 
  ê·¸ë¦¬ê³  ì–´ë–»ê²Œ ì§ˆë¬¸ì„ ë‚ ë¦¬ëŠ”ê²Œ ì¢‹ì„ê¹Œ.

â— Looking at your C source code file and the need to vectorize it similar to your
  existing 1.0 doclining-context-category-chunk_ê·œì •_v2.py using DoclingLoader,
  HybridChunker, and BGEM3FlagModel, here's my recommendation:

â— Read(FBKO5310.c)
  â¿  Read 823 lines (ctrl+o to expand)

â— C ì†ŒìŠ¤ì½”ë“œë¥¼ DoclingLoader, HybridChunker, BGEM3FlagModelë¡œ ë²¡í„°í™”í•˜ëŠ” ë°©ë²•ê³¼ ì§ˆë¬¸
  ì „ëµì„ ì œì•ˆë“œë¦¬ê² ìŠµë‹ˆë‹¤.

  ë²¡í„°í™” ë°©ë²•

  1. C ì†ŒìŠ¤ì½”ë“œì˜ íŠ¹ì„± ê³ ë ¤í•œ ì²­í‚¹ ì „ëµ

  from langchain_docling import DoclingLoader
  from docling.chunking import HybridChunker
  from FlagEmbedding import BGEM3FlagModel

  # C ì½”ë“œ íŠ¹ì„±í™”ëœ ì²­í‚¹ ì„¤ì •
  chunker = HybridChunker(
      chunk_size=1000,  # C í•¨ìˆ˜ ë‹¨ìœ„ ê³ ë ¤
      chunk_overlap=200,

      # C ì½”ë“œ êµ¬ì¡° ì¸ì‹ ì„¤ì •
      separators=[
          "\n/*-----------------------------------------------------------------------
  -------------------------*/\n",  # ì„¹ì…˜ êµ¬ë¶„ì
          "\nstatic int ",  # í•¨ìˆ˜ ì‹œì‘
          "\nextern int ",  # ì™¸ë¶€ í•¨ìˆ˜
          "\n#include ",   # í—¤ë” í¬í•¨
          "\n#define ",    # ë§¤í¬ë¡œ ì •ì˜
          "\ntypedef struct",  # êµ¬ì¡°ì²´ ì •ì˜
      ],
      keep_separator=True
  )

  # FBKO5310.c íŠ¹í™” ì²­í‚¹
  def create_code_chunks(file_path):
      loader = DoclingLoader(file_path)
      docs = loader.load()

      # C ì½”ë“œ ë©”íƒ€ë°ì´í„° ì¶”ê°€
      for doc in docs:
          doc.metadata.update({
              "file_type": "c_source",
              "program_id": "FBKO5310",
              "program_name": "ë³´ê³ ì„œ ì†¡ì‹ ",
              "system": "í•œêµ­ì€í–‰ ë³´ê³ ì„œ ì‹œìŠ¤í…œ",
              "language": "C"
          })

      chunks = chunker.split_documents(docs)

      # ì²­í¬ë³„ ì»¨í…ìŠ¤íŠ¸ ê°•í™”
      enhanced_chunks = []
      for chunk in chunks:
          # í•¨ìˆ˜/ì„¹ì…˜ ì •ë³´ ì¶”ì¶œ
          content = chunk.page_content
          if "static int" in content:
              func_name = extract_function_name(content)
              chunk.metadata["function"] = func_name
              chunk.metadata["chunk_type"] = "function"
          elif "#define" in content:
              chunk.metadata["chunk_type"] = "macro_definitions"
          elif "typedef struct" in content:
              chunk.metadata["chunk_type"] = "data_structure"
          elif "#include" in content:
              chunk.metadata["chunk_type"] = "headers"

          enhanced_chunks.append(chunk)

      return enhanced_chunks

  2. ë²¡í„°í™” ë° ì¸ë±ì‹±

  # BGEM3 ëª¨ë¸ ì´ˆê¸°í™”
  model = BGEM3FlagModel('BAAI/bge-m3', use_fp16=True)

  # ë²¡í„° ì €ì¥ì†Œ êµ¬ì¶•
  def create_vector_store(chunks):
      texts = [chunk.page_content for chunk in chunks]
      metadatas = [chunk.metadata for chunk in chunks]

      # ì„ë² ë”© ìƒì„± (sparse + dense)
      embeddings = model.encode(texts, return_dense=True, return_sparse=True)

      # ê³„ì¸µì  ì¸ë±ìŠ¤ êµ¬ì„±
      return {
          'dense_vectors': embeddings['dense_vecs'],
          'sparse_vectors': embeddings['lexical_weights'],
          'texts': texts,
          'metadatas': metadatas,
          'chunks': chunks
      }

  ì§ˆë¬¸ ì „ëµ

  1. ì½”ë“œ êµ¬ì¡° ì´í•´ ì§ˆë¬¸

  structure_questions = [
      # ì „ì²´ ì•„í‚¤í…ì²˜
      "FBKO5310.c í”„ë¡œê·¸ë¨ì˜ ì „ì²´ êµ¬ì¡°ì™€ ì£¼ìš” ê¸°ëŠ¥ì€ ë¬´ì—‡ì¸ê°€?",
      "í•œêµ­ì€í–‰ ë³´ê³ ì„œ ì†¡ì‹  ì‹œìŠ¤í…œì˜ ì²˜ë¦¬ íë¦„ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”",

      # í•¨ìˆ˜ë³„ ìƒì„¸
      "D1000_Process í•¨ìˆ˜ëŠ” ì–´ë–¤ ì—­í• ì„ í•˜ë©° ì–´ë–¤ ì „ë¬¸ì„ ì²˜ë¦¬í•˜ë‚˜?",
      "MCI í˜¸ì¶œ ê³¼ì •ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì „ë¬¸ êµ¬ì¡°ëŠ” ì–´ë–»ê²Œ êµ¬ì„±ë˜ë‚˜?",

      # ë°ì´í„° êµ¬ì¡°
      "T_BOK_COMMON êµ¬ì¡°ì²´ì˜ ê° í•„ë“œëŠ” ì–´ë–¤ ìš©ë„ë¡œ ì‚¬ìš©ë˜ëŠ”ê°€?",
      "ë³´ê³ ì„œ ì†¡ì‹  ê³¼ì •ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì£¼ìš” ì „ì—­ë³€ìˆ˜ë“¤ì˜ ì—­í• ì€?"
  ]

  2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì§ˆë¬¸

  business_questions = [
      # ì—…ë¬´ íë¦„
      "ê±°ë˜êµ¬ë¶„ ì½”ë“œ 1,2,3ì— ë”°ë¥¸ ì²˜ë¦¬ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ê°€?",
      "íŒŒì¼ í™•ì¸ìš”êµ¬ ì „ë¬¸(MT3004)ì˜ ì²˜ë¦¬ ë¡œì§ì„ ìƒì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”",

      # ì—ëŸ¬ ì²˜ë¦¬
      "í†µì‹ ìƒíƒœë‚´ì—­ë³€ê²½ AG í˜¸ì¶œ ì‹œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ë‚˜?",
      "ì „ë¬¸ ì†¡ì‹  ì‹¤íŒ¨ ì‹œ ì‹œìŠ¤í…œì€ ì–´ë–¤ ë³µêµ¬ ë©”ì»¤ë‹ˆì¦˜ì„ ê°€ì§€ê³  ìˆë‚˜?",

      # ë³´ì•ˆ ê´€ë ¨
      "ì€í–‰ ì¸ì¦ ì •ë³´(BANK_ID, BANK_PWD)ëŠ” ì–´ë–»ê²Œ ê´€ë¦¬ë˜ë‚˜?",
      "ëŒ€ì™¸ í†µì‹  ì‹œ ë³´ì•ˆ ê²€ì¦ ê³¼ì •ì€ ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ë‚˜?"
  ]

  3. ê¸°ìˆ ì  ìƒì„¸ ì§ˆë¬¸

  technical_questions = [
      # ì„±ëŠ¥/ìµœì í™”
      "SEND_DATA_MAX í¬ê¸° ì œí•œì´ ì„±ëŠ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€?",
      "ë ˆì½”ë“œ ë¸”ë¡ í¬ê¸° ê³„ì‚° ë¡œì§ì˜ íš¨ìœ¨ì„±ì„ ê°œì„ í•  ë°©ë²•ì€?",

      # ìœ ì§€ë³´ìˆ˜
      "ìƒˆë¡œìš´ ì „ë¬¸ íƒ€ì… ì¶”ê°€ ì‹œ ìˆ˜ì •ì´ í•„ìš”í•œ ë¶€ë¶„ì€ ì–´ë””ì¸ê°€?",
      "SQLIO ì¸í„°í˜ì´ìŠ¤ ë³€ê²½ ì‹œ ì˜í–¥ì„ ë°›ëŠ” í•¨ìˆ˜ë“¤ì€?",

      # ë””ë²„ê¹…
      "PUSRDSP ë¡œê·¸ ë©”ì‹œì§€ë“¤ë¡œ ì–´ë–¤ ë¬¸ì œë¥¼ ì¶”ì í•  ìˆ˜ ìˆë‚˜?",
      "ì „ë¬¸ ê¸¸ì´ ê³„ì‚° ì˜¤ë¥˜ê°€ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆëŠ” ì§€ì ì€?"
  ]

  4. ì‹œìŠ¤í…œ ì—°ê³„ ì§ˆë¬¸

  integration_questions = [
      # ì™¸ë¶€ ì‹œìŠ¤í…œ
      "MIC ì‹œìŠ¤í…œê³¼ì˜ ì—°ë™ì—ì„œ ì¤‘ìš”í•œ ê³ ë ¤ì‚¬í•­ì€?",
      "DBIO/SQLIO ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•œ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ êµ¬ì¡°ëŠ”?",

      # ëª¨ë“ˆ ì˜ì¡´ì„±
      "FBKG5410, FBKG5420, FBKG5440 AGë“¤ì˜ ì—­í• ê³¼ í˜¸ì¶œ ìˆœì„œëŠ”?",
      "SFBK5310000 êµ¬ì¡°ì²´ê°€ ë‹¤ë¥¸ ëª¨ë“ˆê³¼ ì–´ë–»ê²Œ ì—°ë™ë˜ë‚˜?",

      # ì„¤ì • ê´€ë¦¬
      "ì‹œìŠ¤í…œë³„ ì„¤ì •ê°’ë“¤(ì€í–‰ì½”ë“œ, ì±„ë„ID ë“±)ì˜ ê´€ë¦¬ ë°©ë²•ì€?",
      "í™˜ê²½ë³„ ë°°í¬ ì‹œ ë³€ê²½ë˜ì–´ì•¼ í•  ì„¤ì •ë“¤ì€ ë¬´ì—‡ì¸ê°€?"
  ]

  5. RAG ì‹œìŠ¤í…œ êµ¬í˜„

  def answer_question(question, vector_store, model, k=5):
      # 1. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (dense + sparse)
      query_embedding = model.encode([question], return_dense=True,
  return_sparse=True)

      # 2. ê´€ë ¨ ì²­í¬ ê²€ìƒ‰
      relevant_chunks = hybrid_search(
          query_embedding,
          vector_store,
          k=k,
          alpha=0.7  # dense:sparse ë¹„ìœ¨
      )

      # 3. ì»¨í…ìŠ¤íŠ¸ êµ¬ì„± (í•¨ìˆ˜ë³„, ì„¹ì…˜ë³„ ê·¸ë£¹í™”)
      context = build_hierarchical_context(relevant_chunks)

      # 4. ë‹µë³€ ìƒì„±
      prompt = f"""
      ë‹¤ìŒì€ FBKO5310.c í•œêµ­ì€í–‰ ë³´ê³ ì„œ ì†¡ì‹  í”„ë¡œê·¸ë¨ì˜ ì†ŒìŠ¤ì½”ë“œì…ë‹ˆë‹¤.
      
      ì»¨í…ìŠ¤íŠ¸:
      {context}
      
      ì§ˆë¬¸: {question}
      
      ì½”ë“œì˜ êµ¬ì²´ì ì¸ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì •í™•í•˜ê³  ìƒì„¸í•œ ë‹µë³€ì„ ì œê³µí•´ì£¼ì„¸ìš”.
      í•„ìš”ì‹œ í•´ë‹¹ ì½”ë“œ ë¼ì¸ì„ ì¸ìš©í•˜ì—¬ ì„¤ëª…í•´ì£¼ì„¸ìš”.
      """

      return prompt

  ì´ ë°©ì‹ìœ¼ë¡œ C ì†ŒìŠ¤ì½”ë“œë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ë²¡í„°í™”í•˜ê³ , ê³„ì¸µì ì´ê³  êµ¬ì¡°í™”ëœ ì§ˆë¬¸ì„ í†µí•´
  ì½”ë“œì— ëŒ€í•œ ê¹Šì´ ìˆëŠ” ì´í•´ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
